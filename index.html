<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Lane Battle Extended</title>
  <style>
    body { margin:0; background:#0d0f18; font-family:sans-serif; color:#eee; display:flex; flex-direction:column; align-items:center; }
    header { margin:10px; display:flex; gap:10px; justify-content:space-between; width:90%; max-width:1000px; }
    canvas { border:2px solid #333; border-radius:10px; background:linear-gradient(#1a2d40,#0c1520); }
    .ui { display:grid; grid-template-columns:repeat(5,1fr); gap:8px; margin:10px; width:90%; max-width:1000px; }
    .card { background:#1c2539; border:1px solid #444; border-radius:10px; padding:8px; cursor:pointer; transition:.1s; }
    .card:hover { filter:brightness(1.2); }
    .disabled { filter:grayscale(1) brightness(.6); cursor:not-allowed; }
    #overlay { position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); }
    #modal { background:#111a2d; padding:20px; border-radius:12px; text-align:center; }
  </style>
</head>
<body>
  <header>
    <div>Mini Lane Battle â€” Extended</div>
    <div>Level: <span id="level">1</span></div>
    <div>Elixir: <span id="elixirText">0</span>/10</div>
  </header>

  <canvas id="board" width="1000" height="520"></canvas>

  <div class="ui">
    <div class="card" data-unit="knight">Knight (3)</div>
    <div class="card" data-unit="archer">Archer (2)</div>
    <div class="card" data-unit="tank">Tank (5)</div>
    <div class="card" data-unit="sprinter">Sprinter (4)</div>
    <div class="card" data-unit="flyer">Dragon (6)</div>
  </div>

  <div id="overlay">
    <div id="modal">
      <h2 id="resultTitle">Victory!</h2>
      <p id="resultDesc">You won this level.</p>
      <button id="nextBtn">Next Level</button>
      <button id="restartBtn">Restart</button>
    </div>
  </div>

<script>
(() => {
  const W=1000,H=520;
  const ctx=document.getElementById('board').getContext('2d');
  const LANES=[H*0.25,H*0.5,H*0.75];
  const UNITS={
    knight:{name:'Knight',cost:3,hp:220,dmg:22,range:20,spd:.7,size:14,color:'#6dd3ff'},
    archer:{name:'Archer',cost:2,hp:120,dmg:16,range:120,spd:.6,size:10,color:'#ffd36d'},
    tank:{name:'Tank',cost:5,hp:520,dmg:18,range:24,spd:.45,size:16,color:'#9cff6d'},
    sprinter:{name:'Sprinter',cost:4,hp:140,dmg:28,range:16,spd:1.3,size:12,color:'#ff86d9'},
    flyer:{name:'Dragon',cost:6,hp:300,dmg:24,range:100,spd:0.9,size:16,color:'#ff4444',flying:true}
  };

  let elixir=5,maxElixir=10,elixirRegen=0.025;
  const elixirText=document.getElementById('elixirText');
  function updateElixir(){ elixir=Math.min(maxElixir,elixir+elixirRegen); elixirText.textContent=Math.floor(elixir); }

  const playerTower={x:40,y:H/2-30,hp:1000,max:1000};
  const enemyTower={x:W-70,y:H/2-30,hp:1000,max:1000};
  const allies=[],foes=[],fx=[];
  let selected=null,running=true,level=1;

  document.querySelectorAll('.card').forEach(card=>{
    card.onclick=()=>{ if(card.classList.contains('disabled'))return; selected=card.dataset.unit; };
  });

  document.getElementById('board').addEventListener('click',e=>{
    if(!selected) return;
    const rect=e.target.getBoundingClientRect();
    const y=e.clientY-rect.top;
    const lane=LANES.reduce((p,c)=>Math.abs(c-y)<Math.abs(p-y)?c:p);
    placeUnit(selected,80,lane,1);
    selected=null;
  });

  function placeUnit(key,x,y,dir){
    const u=UNITS[key];
    if(elixir<u.cost)return;
    elixir-=u.cost;
    allies.push({...u,x,y,dir,hp:u.hp});
  }

  function placeEnemy(){
    if(Math.random()<0.02*level){
      const pick=Object.values(UNITS)[Math.floor(Math.random()*Object.keys(UNITS).length)];
      foes.push({...pick,x:W-80,y:LANES[Math.floor(Math.random()*LANES.length)],dir:-1,hp:pick.hp});
    }
  }

  function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}

  function combatStep(listA,listB,tower){
    for(const u of listA){
      const enemy=listB.find(v=>Math.abs(v.y-u.y)<12 && dist(u,v)<=u.range);
      if(enemy){ enemy.hp-=u.dmg/30; continue; }
      if(Math.abs(tower.y+30-u.y)<60 && Math.abs(tower.x-u.x)<40){ tower.hp-=u.dmg/30; continue; }
      u.x+=u.spd*u.dir;
    }
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle='#223';
    ctx.fillRect(0,0,W,H);
    LANES.forEach(y=>{ctx.strokeStyle='#345';ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();});
    drawTower(playerTower,true);
    drawTower(enemyTower,false);
    allies.forEach(drawUnit);
    foes.forEach(drawUnit);
  }
  function drawUnit(u){
    ctx.fillStyle=u.color;
    ctx.beginPath();ctx.arc(u.x,u.y,u.size,0,Math.PI*2);ctx.fill();
  }
  function drawTower(t,f){ctx.fillStyle=f?'#48f':'#f44';ctx.fillRect(t.x,t.y,30,60);} 

  function loop(){
    if(!running)return;
    updateElixir();
    placeEnemy();
    combatStep(allies,foes,enemyTower);
    combatStep(foes,allies,playerTower);
    allies.filter(u=>u.hp>0);
    foes.filter(u=>u.hp>0);
    if(enemyTower.hp<=0||playerTower.hp<=0){ endGame(enemyTower.hp<=0?'Victory!':'Defeat'); return; }
    draw();
    requestAnimationFrame(loop);
  }

  function endGame(msg){ running=false; document.getElementById('overlay').style.display='flex'; document.getElementById('resultTitle').textContent=msg; document.getElementById('resultDesc').textContent= msg==='Victory!'? 'Level cleared!':'You lost...'; }
  document.getElementById('nextBtn').onclick=()=>{ level++; document.getElementById('level').textContent=level; reset(); };
  document.getElementById('restartBtn').onclick=()=>{ level=1; document.getElementById('level').textContent=level; reset(); };

  function reset(){ allies.length=0;foes.length=0;playerTower.hp=1000;enemyTower.hp=1000;elixir=5;running=true;document.getElementById('overlay').style.display='none';loop(); }
  loop();
})();
</script>
</body>
</html>
